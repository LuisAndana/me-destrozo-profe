<!-- perfil.component.html - DISE√ëO PREMIUM -->
<section class="wrap" *ngIf="!loading()">
  <!-- üåà TOPBAR PREMIUM -->
  <header class="topbar container">
    <div class="title">
      <h1 class="upper">{{ form.get('nombre_completo')?.value || 'Tu Nombre' }}</h1>
      <span class="chip">
        <span class="dot"></span>
        Cliente FitCoach
      </span>
    </div>

    <div class="avatar-stack">
      <div class="avatar">
        <img *ngIf="avatarUrl; else inic" [src]="avatarUrl" alt="Foto de perfil" (error)="avatarUrl = null" />
        <ng-template #inic>
          <div class="letters">{{ inicial }}</div>
        </ng-template>
      </div>

      <div class="avatar-actions">
        <input
          #avatarInput
          id="avatarInput"
          type="file"
          accept="image/*"
          class="hidden-file"
          (change)="onAvatarChange($event)"
        />
        <button 
          class="btn btn-ghost btn-sm" 
          type="button" 
          [disabled]="uploading()"
          (click)="avatarInput.click()"
        >
          <span class="material-icons-outlined">photo_camera</span>
          {{ uploading() ? 'Subiendo‚Ä¶' : 'Cambiar' }}
        </button>
        <button 
          class="btn btn-danger-ghost btn-sm" 
          type="button"
          [disabled]="uploading()"
          (click)="removeAvatar()"
        >
          <span class="material-icons-outlined">close</span> Quitar
        </button>
      </div>
    </div>
  </header>

  <main class="container" [formGroup]="form">
    
    <!-- SECCI√ìN 1: DATOS PERSONALES -->
    <article class="card card-hero">
      <header class="card-head">
        <h3><span class="material-icons-outlined">person</span> Datos Personales</h3>
      </header>

      <div class="form-grid">
        <div class="form-group">
          <label class="label">Nombre Completo</label>
          <input 
            type="text" 
            class="input"
            [value]="form.get('nombre_completo')?.value || ''"
            disabled
            placeholder="Tu nombre completo" 
          />
        </div>

        <div class="form-group">
          <label class="label">Email</label>
          <input 
            type="email" 
            class="input"
            [value]="form.get('email')?.value || ''"
            disabled
            placeholder="Tu email" 
          />
        </div>

        <div class="form-group">
          <label class="label"><span class="material-icons-outlined">wc</span> Sexo</label>
          <select class="input" formControlName="sexo">
            <option value="">Seleccionar</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro / Prefiero no decir</option>
          </select>
        </div>

        <div class="form-group">
          <label class="label"><span class="material-icons-outlined">calendar_today</span> Edad</label>
          <input 
            type="number" 
            class="input"
            min="0" 
            max="120"
            formControlName="edad" 
            placeholder="A√±os" 
          />
        </div>
      </div>
    </article>

    <!-- SECCI√ìN 2: MEDIDAS CORPORALES Y IMC -->
    <div class="grid-single">
      <article class="card card-secondary">
        <header class="card-head-compact">
          <h3><span class="material-icons-outlined">straighten</span> Medidas Corporales</h3>
        </header>

        <div class="form-grid">
          <div class="form-group span-full">
            <label class="label"><span class="material-icons-outlined">scale</span> Peso (kg)</label>
            <input 
              type="number" 
              class="input"
              step="0.1" 
              min="0"
              formControlName="peso_kg" 
              placeholder="Ej. 64.5" 
            />
          </div>

          <div class="form-group span-full">
            <label class="label"><span class="material-icons-outlined">height</span> Estatura (cm)</label>
            <input 
              type="number" 
              class="input"
              step="0.1" 
              min="0"
              formControlName="estatura_cm" 
              placeholder="Ej. 172" 
            />
          </div>
        </div>
      </article>

      <article class="card card-price">
        <header class="card-head-compact">
          <h3><span class="material-icons-outlined">info</span> IMC Estimado</h3>
        </header>

        <div class="imc-display">
          <div class="imc-value" *ngIf="form.get('peso_kg')?.value && form.get('estatura_cm')?.value; else imcNulo">
            {{ calcularIMC() | number:'1.1-1' }}
          </div>
          <ng-template #imcNulo>
            <div class="imc-value">‚Äî</div>
          </ng-template>
          <p class="imc-label">√çndice de Masa Corporal</p>
          <p class="imc-hint">Completa peso y estatura para calcular</p>
        </div>
      </article>
    </div>

    <!-- SECCI√ìN 3: INFORMACI√ìN DE SALUD -->
    <article class="card card-hero">
      <header class="card-head">
        <h3><span class="material-icons-outlined">health_and_safety</span> Problemas / Antecedentes</h3>
      </header>

      <div class="form-grid">
        <div class="form-group span-full">
          <label class="label"><span class="material-icons-outlined">notes</span> Describe tus condiciones</label>
          <textarea 
            class="input textarea"
            rows="4"
            formControlName="problemas" 
            placeholder="Describe lesiones, dificultades, limitaciones, etc."
          ></textarea>
          <p class="help-text">Mientras m√°s contexto nos des, mejor se ajustar√°n tus rutinas.</p>
        </div>
      </div>
    </article>

    <!-- SECCI√ìN 4: ENFERMEDADES -->
    <article class="card card-hero">
      <header class="card-head">
        <h3><span class="material-icons-outlined">vaccines</span> Condiciones M√©dicas</h3>
      </header>

      <!-- Lista de enfermedades -->
      <div class="enfermedades-section">
        <label class="label">Selecciona las que apliquen:</label>
        <div class="enfermedades-grid" formArrayName="enfermedades">
          <label *ngFor="let enf of enfermedadesCatalogo; let i = index" class="checkbox-item">
            <input 
              type="checkbox" 
              [formControlName]="i"
              class="checkbox-input"
            />
            <span class="checkbox-label">{{ enf }}</span>
          </label>
        </div>
      </div>
    </article>

  </main>

  <!-- FOOTER CON ACCIONES FIJAS -->
  <footer class="actions container">
    <span class="status" *ngIf="estado">{{ estado }}</span>
    <button 
      class="btn btn-ghost" 
      type="button"
      (click)="cancelar()"
      [disabled]="saving()"
    >
      <span class="material-icons-outlined">cancel</span> Cancelar
    </button>
    <button 
      class="btn btn-accent" 
      type="button"
      [disabled]="saving()"
      (click)="guardar()"
    >
      <span class="material-icons-outlined">{{ saving() ? 'hourglass_top' : 'check' }}</span>
      {{ saving() ? 'Guardando...' : 'Guardar Cambios' }}
    </button>
  </footer>
</section>

<!-- Loading state -->
<section class="wrap" *ngIf="loading()">
  <div class="loading-skeleton">
    <div class="skeleton-avatar"></div>
    <div class="skeleton-text"></div>
  </div>
</section>