import{a as f}from"./chunk-V7WHDDYD.js";import{L as i,P as h,T as b,k as c,l as s,lc as g,o as p,oc as E,x as a}from"./chunk-VJI5GMUY.js";var m=window.env?.apiUrl||f.apiBase||"http://localhost:8000",l=`${m}/cliente-entrenador`,d=`${m}/pagos`,I=class u{constructor(e){this.http=e;console.log("[ClienteEntrenadorService] Inicializado \u2705"),console.log("[ClienteEntrenadorService] API URL:",m),console.log("[ClienteEntrenadorService] BASE_URL:",l)}authHeaders(){let e=localStorage.getItem("token")||localStorage.getItem("access_token");return!e||e.length<8?new g({"Content-Type":"application/json"}):new g({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}handleError(e){console.error("[handleError] Error completo:",e);let r=e.error?.detail||e.error?.message||e.message||"Error desconocido";return s(()=>({status:e.status,message:r,error:e.error}))}getIdClienteFromStorage(){let e=localStorage.getItem("id_cliente")||"",r=parseInt(e,10);if(r>0)return r;try{let t=JSON.parse(localStorage.getItem("usuario")||"null");if(t?.id)return Number(t.id)}catch{}return 0}getIdEntrenadorFromStorage(){let e=localStorage.getItem("id_entrenador")||"",r=parseInt(e,10);if(r>0)return r;try{let t=JSON.parse(localStorage.getItem("usuario")||"null");if(t?.id&&(t.rol==="entrenador"||t.rol==="trainer"))return Number(t.id)}catch{}return 0}contratarEntrenador(e,r){console.log("[contratarEntrenador] Iniciando con ID entrenador:",e);let t=this.getIdClienteFromStorage();if(!t)return s(()=>({status:400,message:"id_cliente no disponible en localStorage"}));if(!e)return s(()=>({status:400,message:"id_entrenador inv\xE1lido"}));let n={id_cliente:t,id_entrenador:e,notas:r};return this.http.post(`${l}/contratar`,n,{headers:this.authHeaders()}).pipe(i(o=>console.log("[contratarEntrenador] \u2705 \xC9xito:",o)),a(o=>this.handleError(o)))}misClientes(e){let r=e||this.getIdEntrenadorFromStorage();if(!r)return s(()=>({status:400,message:"id_entrenador requerido"}));let t=`${l}/mis-clientes/${r}`;return this.http.get(t,{headers:this.authHeaders()}).pipe(i(n=>console.log("[misClientes] \u2705 Total:",n.length)),a(n=>this.handleError(n)))}miEntrenador(e){let r=e||this.getIdClienteFromStorage();if(!r)return s(()=>({status:400,message:"id_cliente requerido"}));let t=`${l}/mi-entrenador/${r}`;return this.http.get(t,{headers:this.authHeaders()}).pipe(i(n=>n?console.log("[miEntrenador] \u2705 Entrenador:",n.entrenador.nombre):console.log("[miEntrenador] \u2139\uFE0F No tiene entrenador")),a(n=>this.handleError(n)))}tengoEsteEntrenador(e,r){let t=r||this.getIdClienteFromStorage();if(!t)return console.warn("[tengoEsteEntrenador] \u26A0\uFE0F id_cliente no disponible; se devuelve false"),c(!1);if(!e)return c(!1);let n=`${l}/relacion?id_cliente=${t}&id_entrenador=${e}`;return this.http.get(n,{headers:this.authHeaders()}).pipe(p(o=>!!o),i(o=>console.log("[tengoEsteEntrenador] \u2705 Resultado:",o)),a(o=>(console.error("[tengoEsteEntrenador] \u274C Error:",o),c(!1))))}cancelarRelacion(e){return e?this.http.delete(`${l}/${e}`,{headers:this.authHeaders()}).pipe(i(()=>console.log("[cancelarRelacion] \u2705 Relaci\xF3n cancelada")),a(r=>this.handleError(r))):s(()=>({status:400,message:"id_relacion inv\xE1lido"}))}crearPaymentIntent(e,r,t){console.log("[crearPaymentIntent] Iniciando con:",{idCliente:e,idEntrenador:r,monto:t});let n=`${d}/stripe/payment-intent`;return this.http.post(n,{},{headers:this.authHeaders(),params:{id_cliente:e.toString(),id_entrenador:r.toString(),monto:t.toString()}}).pipe(i(o=>{console.log("[crearPaymentIntent] \u2705 PaymentIntent creado:",{id_pago:o.id_pago,hasClientSecret:!!o.client_secret})}),a(o=>(console.error("[crearPaymentIntent] \u274C Error:",o),this.handleError(o))))}confirmarPago(e,r){console.log("[confirmarPago] Confirmando pago:",e);let t=`${d}/${e}/confirmar`;return this.http.post(t,{},{headers:this.authHeaders(),params:r?{referencia_externa:r}:{}}).pipe(i(n=>console.log("[confirmarPago] \u2705 Pago confirmado:",n)),a(n=>(console.error("[confirmarPago] \u274C Error:",n),this.handleError(n))))}obtenerHistorialPagos(e,r){console.log("[obtenerHistorialPagos] Obteniendo historial:",{idCliente:e,idEntrenador:r});let t=`${d}/cliente/historial`,n={id_cliente:e};return r&&(n.id_entrenador=r),this.http.get(t,{headers:this.authHeaders(),params:n}).pipe(i(o=>console.log("[obtenerHistorialPagos] \u2705 Historial obtenido")),a(o=>(console.error("[obtenerHistorialPagos] \u274C Error:",o),this.handleError(o))))}obtenerIngresosEntrenador(e,r){console.log("[obtenerIngresosEntrenador] Obteniendo ingresos:",{idEntrenador:e,estado:r});let t=`${d}/entrenador/ingresos`,n={id_entrenador:e};return r&&(n.estado=r),this.http.get(t,{headers:this.authHeaders(),params:n}).pipe(i(o=>console.log("[obtenerIngresosEntrenador] \u2705 Ingresos obtenidos:",o.length)),a(o=>(console.error("[obtenerIngresosEntrenador] \u274C Error:",o),this.handleError(o))))}static \u0275fac=function(r){return new(r||u)(b(E))};static \u0275prov=h({token:u,factory:u.\u0275fac,providedIn:"root"})};export{I as a};
