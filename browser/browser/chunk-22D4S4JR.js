import{a as q}from"./chunk-BOOOHMUF.js";import{a as U}from"./chunk-753XICM7.js";import"./chunk-V7WHDDYD.js";import{b as A,d as F,g as z,y as T}from"./chunk-T5YDL63U.js";import{e as N,j as S}from"./chunk-XCTHI3QZ.js";import{$b as D,K as b,La as O,Pa as p,U as C,Wa as d,Xa as i,Ya as r,Z as v,Za as w,_ as f,ac as E,db as _,eb as m,f as x,gb as s,gc as I,pb as c,qb as g,rb as h,ta as M,tb as y,ub as P,vb as k,wa as a}from"./chunk-VJI5GMUY.js";import"./chunk-FDERIQAA.js";function V(n,t){if(n&1){let e=_();i(0,"button",14),m("click",function(){v(e);let l=s();return f(l.limpiarBusqueda())}),c(1," \u2715 "),r()}}function $(n,t){n&1&&(i(0,"div",15),w(1,"div",16),i(2,"p"),c(3,"Cargando contactos..."),r()())}function L(n,t){if(n&1){let e=_();i(0,"div",17)(1,"span",18),c(2,"\u26A0\uFE0F"),r(),i(3,"p"),c(4),r(),i(5,"button",19),m("click",function(){v(e);let l=s();return f(l.recargar())}),c(6,"Reintentar"),r()()}if(n&2){let e=s();a(4),g(e.error)}}function B(n,t){if(n&1&&(i(0,"div",20)(1,"div",21),c(2,"\u{1F465}"),r(),i(3,"h2"),c(4),r(),i(5,"p"),c(6),r()()),n&2){let e=s();a(4),g(e.busqueda?"Sin resultados":"No hay contactos disponibles"),a(2),g(e.busqueda?"Intenta con otra b\xFAsqueda":"No tienes contactos para iniciar una conversaci\xF3n")}}function R(n,t){if(n&1){let e=_();i(0,"img",34),m("error",function(l){v(e);let u=s(3);return f(u.onImageError(l))}),r()}if(n&2){let e=s().$implicit,o=s(2);d("src",e.foto_url,M)("alt",o.obtenerNombreCompleto(e))}}function W(n,t){if(n&1&&(i(0,"div",35),c(1),r()),n&2){let e=s().$implicit,o=s(2);a(),h(" ",o.obtenerIniciales(e)," ")}}function J(n,t){if(n&1&&(i(0,"p",36),c(1),r()),n&2){let e=s().$implicit;a(),h(" ",e.rol==="cliente"?"\u{1F464} Cliente":"\u{1F4AA} Entrenador"," ")}}function Y(n,t){if(n&1&&(i(0,"p",37),c(1),r()),n&2){let e=s().$implicit;a(),g(e.email)}}function G(n,t){if(n&1){let e=_();i(0,"div",24),m("click",function(){let l=v(e).$implicit,u=s(2);return f(u.iniciarConversacion(l))}),i(1,"div",25),p(2,R,1,2,"img",26)(3,W,2,1,"div",27),r(),i(4,"div",28)(5,"h3",29),c(6),r(),p(7,J,2,1,"p",30)(8,Y,2,1,"p",31),r(),i(9,"div",32)(10,"span",33),c(11,"\u{1F4AC}"),r()()()}if(n&2){let e=t.$implicit,o=s(2);a(2),d("ngIf",e.foto_url),a(),d("ngIf",!e.foto_url),a(3),g(o.obtenerNombreCompleto(e)),a(),d("ngIf",e.rol),a(),d("ngIf",e.email)}}function H(n,t){if(n&1&&(i(0,"div",22),p(1,G,12,5,"div",23),r()),n&2){let e=s();a(),d("ngForOf",e.contactosFiltrados)}}var j=class n{clienteEntrenadorService=C(U);mensajesService=C(q);router=C(N);destroy$=new x;contactosDisponibles=[];contactosFiltrados=[];cargando=!0;error=null;busqueda="";idUsuarioActual;rolUsuarioActual="";defaultAvatar='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Crect fill="%236366f1" width="100" height="100"/%3E%3Ctext x="50" y="50" font-size="40" fill="white" text-anchor="middle" dy=".3em"%3E?%3C/text%3E%3C/svg%3E';ngOnInit(){console.log("\u270F\uFE0F [INIT] NuevaConversacionComponent"),this.obtenerInfoUsuarioActual(),this.cargarContactosDisponibles()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}obtenerInfoUsuarioActual(){try{let t=localStorage.getItem("usuario");if(!t){this.error="No se pudo identificar al usuario actual",this.cargando=!1;return}let e=JSON.parse(t);this.idUsuarioActual=e.id||e.id_usuario||0,this.rolUsuarioActual=e.rol||"",console.log("\u{1F464} Usuario actual:",{id:this.idUsuarioActual,rol:this.rolUsuarioActual})}catch(t){console.error("\u274C Error al obtener usuario:",t),this.error="Error al obtener informaci\xF3n del usuario",this.cargando=!1}}cargarContactosDisponibles(){if(!this.idUsuarioActual){this.error="Usuario no identificado",this.cargando=!1;return}this.cargando=!0,this.rolUsuarioActual==="entrenador"||this.rolUsuarioActual==="trainer"?this.cargarClientes():this.cargarEntrenador()}cargarClientes(){this.clienteEntrenadorService.misClientes(this.idUsuarioActual).pipe(b(this.destroy$)).subscribe({next:t=>{console.log("\u2705 Clientes cargados:",t.length),this.contactosDisponibles=t.map(e=>({id_usuario:e.cliente.id_usuario,nombre:e.cliente.nombre,apellido:e.cliente.apellido??"",foto_url:e.cliente.foto_url,rol:"cliente",email:e.cliente.email})),this.contactosFiltrados=[...this.contactosDisponibles],this.cargando=!1,this.contactosDisponibles.length===0&&console.log("\u26A0\uFE0F El entrenador no tiene clientes asignados")},error:t=>{console.error("\u274C Error al cargar clientes:",t),this.error="No se pudieron cargar los clientes. Intenta nuevamente.",this.cargando=!1}})}cargarEntrenador(){this.clienteEntrenadorService.miEntrenador(this.idUsuarioActual).pipe(b(this.destroy$)).subscribe({next:t=>{t&&t.entrenador?(console.log("\u2705 Entrenador cargado:",t.entrenador.nombre),this.contactosDisponibles=[{id_usuario:t.entrenador.id_usuario,nombre:t.entrenador.nombre,foto_url:t.entrenador.foto_url,rol:"entrenador",email:t.entrenador.email}]):(console.log("\u26A0\uFE0F El cliente no tiene un entrenador asignado"),this.contactosDisponibles=[]),this.contactosFiltrados=[...this.contactosDisponibles],this.cargando=!1,this.contactosDisponibles.length===0&&(this.error="No tienes un entrenador asignado a\xFAn. Contacta con administraci\xF3n.")},error:t=>{console.error("\u274C Error al cargar entrenador:",t),this.error="No se pudo cargar tu entrenador. Intenta nuevamente.",this.cargando=!1}})}filtrarContactos(){let t=this.busqueda.toLowerCase().trim();if(!t){this.contactosFiltrados=[...this.contactosDisponibles];return}this.contactosFiltrados=this.contactosDisponibles.filter(e=>{let o=this.obtenerNombreCompleto(e).toLowerCase(),l=(e.email||"").toLowerCase();return o.includes(t)||l.includes(t)})}limpiarBusqueda(){this.busqueda="",this.filtrarContactos()}iniciarConversacion(t){console.log("\u{1F4AC} Iniciando conversaci\xF3n con:",t.nombre),this.router.navigate(["/mensajes/chat",t.id_usuario])}volver(){this.router.navigate(["/mensajes"])}recargar(){console.log("\u{1F504} Recargando contactos..."),this.cargarContactosDisponibles()}obtenerIniciales(t){return this.mensajesService.obtenerIniciales(t)}obtenerNombreCompleto(t){return this.mensajesService.obtenerNombreCompleto(t)}onImageError(t){t.target.src=this.defaultAvatar}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=O({type:n,selectors:[["app-nueva-conversacion"]],decls:19,vars:6,consts:[[1,"nueva-conversacion-container"],[1,"nueva-conversacion-header"],["title","Volver",1,"btn-back",3,"click"],["title","Recargar",1,"btn-icon",3,"click"],[1,"search-bar"],[1,"search-input-wrapper"],[1,"search-icon"],["type","text","placeholder","Buscar contacto...",1,"search-input",3,"ngModelChange","ngModel"],["class","clear-btn","title","Limpiar b\xFAsqueda",3,"click",4,"ngIf"],[1,"nueva-conversacion-content"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","empty-container",4,"ngIf"],["class","contactos-lista",4,"ngIf"],["title","Limpiar b\xFAsqueda",1,"clear-btn",3,"click"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-container"],[1,"error-icon"],[1,"btn-primary",3,"click"],[1,"empty-container"],[1,"empty-icon"],[1,"contactos-lista"],["class","contacto-item",3,"click",4,"ngFor","ngForOf"],[1,"contacto-item",3,"click"],[1,"avatar-container"],["class","avatar",3,"src","alt","error",4,"ngIf"],["class","avatar avatar-placeholder",4,"ngIf"],[1,"contacto-info"],[1,"nombre"],["class","rol",4,"ngIf"],["class","email",4,"ngIf"],[1,"contacto-action"],[1,"icon-chat"],[1,"avatar",3,"error","src","alt"],[1,"avatar","avatar-placeholder"],[1,"rol"],[1,"email"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return o.volver()}),c(3," \u2190 "),r(),i(4,"h1"),c(5,"Nueva Conversaci\xF3n"),r(),i(6,"button",3),m("click",function(){return o.recargar()}),c(7," \u{1F504} "),r()(),i(8,"div",4)(9,"div",5)(10,"span",6),c(11,"\u{1F50D}"),r(),i(12,"input",7),k("ngModelChange",function(u){return P(o.busqueda,u)||(o.busqueda=u),u}),m("ngModelChange",function(){return o.filtrarContactos()}),r(),p(13,V,2,0,"button",8),r()(),i(14,"div",9),p(15,$,4,0,"div",10)(16,L,7,1,"div",11)(17,B,7,2,"div",12)(18,H,2,1,"div",13),r()()),e&2&&(a(12),y("ngModel",o.busqueda),a(),d("ngIf",o.busqueda),a(2),d("ngIf",o.cargando),a(),d("ngIf",o.error&&!o.cargando),a(),d("ngIf",!o.cargando&&!o.error&&o.contactosFiltrados.length===0),a(),d("ngIf",!o.cargando&&!o.error&&o.contactosFiltrados.length>0))},dependencies:[I,D,E,S,T,A,F,z],styles:[".nueva-conversacion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;max-height:100vh;background:linear-gradient(135deg,#0f1419,#1a202c);overflow:hidden}.nueva-conversacion-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1.5rem;background:#1e2836cc;border-bottom:1px solid rgba(42,63,95,.3);box-shadow:0 2px 8px #0000004d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);gap:1rem}.nueva-conversacion-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700;color:#fff;flex:1}.btn-back[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;border:none;background:#ffffff0d;cursor:pointer;font-size:1.5rem;display:flex;align-items:center;justify-content:center;transition:all .3s ease;color:#fff}.btn-back[_ngcontent-%COMP%]:hover{background:#00a88433;color:#00a884}.btn-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;border:none;background:#ffffff0d;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;font-size:1.2rem}.btn-icon[_ngcontent-%COMP%]:hover{background:#00a88433}.search-bar[_ngcontent-%COMP%]{padding:1rem 1.5rem;background:#1e283666;border-bottom:1px solid rgba(42,63,95,.3)}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background:#141e2dcc;border-radius:10px;padding:.75rem 1rem;border:1px solid rgba(42,63,95,.3);transition:all .3s ease}.search-input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:#00a88480;box-shadow:0 0 12px #00a88433}.search-icon[_ngcontent-%COMP%]{font-size:1.2rem;margin-right:.75rem;color:#8696a0}.search-input[_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem;color:#fff;font-family:inherit}.search-input[_ngcontent-%COMP%]::placeholder{color:#8696a0}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#8696a0;font-size:1.2rem;padding:0;margin-left:.5rem;transition:all .2s ease}.clear-btn[_ngcontent-%COMP%]:hover{color:#00a884;transform:scale(1.1)}.nueva-conversacion-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:transparent}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 2rem;text-align:center}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,168,132,.2);border-top-color:#00a884;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin-bottom:.5rem}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8696a0;margin-bottom:1.5rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00a884,#008c6f);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:10px;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px #00a8844d}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #00a88466}.contactos-lista[_ngcontent-%COMP%]{display:flex;flex-direction:column}.contacto-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 1.5rem;cursor:pointer;border-bottom:1px solid rgba(42,63,95,.2);transition:all .3s ease}.contacto-item[_ngcontent-%COMP%]:hover{background:#00a8840d;padding-left:1.75rem}.avatar-container[_ngcontent-%COMP%]{margin-right:1rem;flex-shrink:0}.avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid rgba(0,168,132,.3)}.avatar-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:600;font-size:1.1rem;border:2px solid rgba(0,168,132,.3)}.contacto-info[_ngcontent-%COMP%]{flex:1;min-width:0}.nombre[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;font-weight:600;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rol[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:.85rem;color:#8696a0;font-weight:500}.email[_ngcontent-%COMP%]{margin:0;font-size:.8rem;color:#8696a0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.contacto-action[_ngcontent-%COMP%]{flex-shrink:0;margin-left:1rem;opacity:0;transition:all .3s ease}.contacto-item[_ngcontent-%COMP%]:hover   .contacto-action[_ngcontent-%COMP%]{opacity:1}.icon-chat[_ngcontent-%COMP%]{font-size:1.5rem;color:#00a884;transition:all .2s ease}.contacto-item[_ngcontent-%COMP%]:hover   .icon-chat[_ngcontent-%COMP%]{transform:scale(1.2)}@media (max-width: 768px){.nueva-conversacion-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25rem}.contacto-item[_ngcontent-%COMP%]{padding:.75rem 1rem}.avatar[_ngcontent-%COMP%]{width:45px;height:45px}.nombre[_ngcontent-%COMP%]{font-size:.95rem}.rol[_ngcontent-%COMP%], .email[_ngcontent-%COMP%]{font-size:.8rem}.contacto-action[_ngcontent-%COMP%]{opacity:1}}.nueva-conversacion-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.nueva-conversacion-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.nueva-conversacion-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#00a8844d;border-radius:3px}.nueva-conversacion-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#00a88480}"]})};export{j as NuevaConversacionComponent};
