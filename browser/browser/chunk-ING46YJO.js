import{a as g}from"./chunk-V7WHDDYD.js";import{b as R,d as F,e as D,f as z,g as N,h as A,t as j,w as B,y as H}from"./chunk-T5YDL63U.js";import{e as T}from"./chunk-XCTHI3QZ.js";import{Ab as P,Fa as x,Ga as b,La as _,Pa as f,Wa as c,Xa as o,Ya as a,Za as h,_b as w,ac as I,ca as y,eb as v,gb as p,gc as S,oc as k,pb as l,rb as m,sc as V,tb as E,ub as M,vb as O,wa as s}from"./chunk-VJI5GMUY.js";import"./chunk-FDERIQAA.js";var U=(r,t)=>({invalid:r,valid:t});function Y(r,t){if(r&1&&(o(0,"div",28),l(1),a()),r&2){let n=p();s(),m(" ",n.successMessage," ")}}function q(r,t){if(r&1&&(o(0,"div",29),l(1),a()),r&2){let n=p();s(),m(" ",n.formErrors.general," ")}}function W(r,t){if(r&1&&(o(0,"div",30),l(1),a()),r&2){let n=p();s(),m(" ",n.successMessage," ")}}function $(r,t){r&1&&(o(0,"span",31),l(1," \u23F3 "),a())}function G(r,t){if(r&1&&(o(0,"div",32),l(1),a()),r&2){let n=p();s(),m(" ",(n.formErrors==null?null:n.formErrors.code)||"Ingresa el c\xF3digo de verificaci\xF3n."," ")}}function K(r,t){r&1&&(o(0,"span"),l(1,"Reenviar C\xF3digo"),a())}function X(r,t){if(r&1&&(o(0,"span"),l(1),a()),r&2){let n=p();s(),m("Reenviar en ",n.resendCountdown,"s")}}var L=class r{constructor(t,n,e,d){this.router=t;this.http=n;this.renderer=e;this.doc=d}email="";verificationCode="";isVerifying=!1;submitted=!1;formErrors={email:"",code:"",general:""};successMessage="";showSuccessAnimation=!1;resendCountdown=0;canResend=!0;ngOnInit(){this.renderer.addClass(this.doc.body,"verify-email-page");let t=sessionStorage.getItem("registerEmail");t&&(this.email=t),console.log("\u2705 VerifyEmailComponent inicializado"),console.log("\u{1F4E7} Email pre-rellenado:",this.email),console.log("\u{1F517} API Base:",g.apiBase),console.log("\u{1F4CD} Endpoint:",g.endpoints.verifyEmail)}ngOnDestroy(){this.renderer.removeClass(this.doc.body,"verify-email-page")}verifyCode(){this.submitted=!0,this.clearErrors();let t=this.email?.trim().toLowerCase();if(!t&&(t=prompt("Por favor, ingresa tu email:")||"",!t)){this.formErrors.email="Ingresa tu email.",this.scrollToFirstError();return}let n=this.verificationCode?.trim();if(console.log("\u{1F50D} [VERIFY CODE] Iniciando verificaci\xF3n..."),console.log("\u{1F4E7} Email:",t),console.log("\u{1F510} C\xF3digo:",n),!n){this.formErrors.code="Ingresa el c\xF3digo de verificaci\xF3n.",this.scrollToFirstError();return}if(n.length<6){this.formErrors.code="El c\xF3digo debe tener al menos 6 caracteres.",this.scrollToFirstError();return}this.isVerifying=!0;let e=`${g.apiBase}${g.endpoints.verifyEmail}`;console.log("\u{1F310} POST a:",e);let d={email:t,token:n};console.log("\u{1F4E4} Payload:",d),this.http.post(e,d).subscribe({next:i=>{this.isVerifying=!1,console.log("\u2705 RESPUESTA RECIBIDA:"),console.log("Completa:",i),console.log("Tipo:",typeof i),console.log("Keys:",Object.keys(i||{})),console.log("success:",i?.success),console.log("ok:",i?.ok),console.log("verified:",i?.verified);let u=i?.success===!0||i?.ok===!0||i?.verified===!0;console.log("\xBFEs exitosa?",u),u?(console.log("\u{1F389} \xA1\xC9XITO! Email verificado"),this.successMessage="\u2713 Email verificado exitosamente",this.showSuccessAnimation=!0,sessionStorage.removeItem("registerEmail"),console.log("\u23F1\uFE0F Esperando 1500ms antes de redirigir..."),setTimeout(()=>{console.log("\u{1F680} NAVEGANDO A /login"),this.router.navigate(["/login"],{replaceUrl:!0}).then(C=>{console.log("\u2705 Navegaci\xF3n exitosa:",C)},C=>{console.error("\u274C Error en navegaci\xF3n:",C)})},1500)):(console.log("\u274C Respuesta no es exitosa. Message:",i?.message),this.formErrors.general=i?.message||i?.detail||"Error verificando email",this.scrollToFirstError(!0))},error:i=>{this.isVerifying=!1,console.error("\u274C ERROR COMPLETO:"),console.error("Status:",i?.status),console.error("StatusText:",i?.statusText),console.error("Error object:",i?.error),console.error("Error message:",i?.message),console.error("Full error:",i);let u=i?.error?.detail||i?.error?.message||i?.error?.msg||i?.message||"Error al verificar el email. Intenta de nuevo.";console.log("\u{1F4CC} Mostrando error al usuario:",u),this.formErrors.general=u,this.scrollToFirstError(!0)}})}resendCode(){this.submitted=!0,this.clearErrors();let t=this.email?.trim().toLowerCase();if(!t&&(t=prompt("Por favor, ingresa tu email:")||"",!t)){this.formErrors.email="Ingresa tu email para reenviar el c\xF3digo.",this.scrollToFirstError();return}if(!this.canResend){this.formErrors.general=`Espera ${this.resendCountdown} segundos antes de reenviar.`;return}this.isVerifying=!0,console.log("\u{1F504} [RESEND] Reenviando c\xF3digo a:",t),this.http.post(`${g.apiBase}${g.endpoints.resendVerification}`,{email:t,nombre:""}).subscribe({next:()=>{this.isVerifying=!1,console.log("\u2705 C\xF3digo reenviado exitosamente"),this.successMessage="\u2713 C\xF3digo reenviado a tu email",this.startResendCountdown(),setTimeout(()=>{this.successMessage=""},3e3)},error:n=>{this.isVerifying=!1,console.error("\u274C Error reenviando:",n);let e=n?.error?.detail||n?.error?.message||"Error reenviando c\xF3digo";this.formErrors.general=e,this.scrollToFirstError(!0)}})}startResendCountdown(){this.canResend=!1,this.resendCountdown=60;let t=setInterval(()=>{this.resendCountdown--,this.resendCountdown<=0&&(clearInterval(t),this.canResend=!0)},1e3)}clearErrors(){this.formErrors={email:"",code:"",general:""}}scrollToFirstError(t=!1){let n=document.querySelector(".field.invalid .control");if(n){n.focus({preventScroll:!1}),n.scrollIntoView({behavior:"smooth",block:"center"});return}t&&window.scrollTo({top:0,behavior:"smooth"})}goBackToRegister(){sessionStorage.setItem("registerEmail",this.email),this.router.navigate(["/registro"])}static \u0275fac=function(n){return new(n||r)(b(T),b(k),b(x),b(y))};static \u0275cmp=_({type:r,selectors:[["app-verify-email"]],decls:42,vars:16,consts:[[1,"verify-email-container"],[1,"verify-banner"],[1,"banner-overlay"],[1,"banner-content"],[1,"check-icon"],[1,"verify-form-section"],["class","success-message",4,"ngIf"],[1,"verify-title"],[1,"verify-subtitle"],["novalidate","",1,"verify-form",3,"ngSubmit"],["class","error-msg general-error",4,"ngIf"],["class","success-msg",4,"ngIf"],[1,"field",3,"ngClass"],[1,"label"],[1,"code-input-wrapper"],["type","text","name","verificationCode","placeholder","Ingresa el c\xF3digo recibido","required","","maxlength","32",1,"control","code-input",3,"ngModelChange","ngModel","disabled"],["class","verifying-spinner",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"help-text"],[1,"form-actions"],["type","submit",1,"verify-btn",3,"disabled"],[1,"divider"],[1,"resend-section"],[1,"resend-label"],["type","button",1,"resend-btn",3,"click","disabled"],[4,"ngIf"],[1,"back-section"],["type","button",1,"back-btn",3,"click"],[1,"success-message"],[1,"error-msg","general-error"],[1,"success-msg"],[1,"verifying-spinner"],[1,"error-msg"]],template:function(n,e){n&1&&(o(0,"div",0)(1,"div",1),h(2,"div",2),o(3,"div",3)(4,"div",4),l(5,"\u2713"),a(),o(6,"h3"),l(7,"Verificaci\xF3n de Email"),a()()(),o(8,"div",5),f(9,Y,2,1,"div",6),o(10,"h2",7),l(11,"Verifica tu Email"),a(),o(12,"p",8),l(13," Hemos enviado un c\xF3digo a tu email. Ingresa el c\xF3digo a continuaci\xF3n para completar tu registro. "),a(),o(14,"form",9),v("ngSubmit",function(){return e.verifyCode()}),f(15,q,2,1,"div",10)(16,W,2,1,"div",11),o(17,"div",12)(18,"label",13),l(19,"C\xF3digo de Verificaci\xF3n"),a(),o(20,"div",14)(21,"input",15),O("ngModelChange",function(i){return M(e.verificationCode,i)||(e.verificationCode=i),i}),a(),f(22,$,2,0,"span",16),a(),f(23,G,2,1,"div",17),a(),o(24,"div",18)(25,"p"),l(26,"\u{1F4E7} Revisa tu bandeja de entrada o spam para encontrar el email con el c\xF3digo."),a(),o(27,"p"),l(28,"El c\xF3digo expira en 24 horas."),a()(),o(29,"div",19)(30,"button",20),l(31),a()(),h(32,"div",21),o(33,"div",22)(34,"p",23),l(35,"\xBFNo recibiste el c\xF3digo?"),a(),o(36,"button",24),v("click",function(){return e.resendCode()}),f(37,K,2,0,"span",25)(38,X,2,1,"span",25),a()(),o(39,"div",26)(40,"button",27),v("click",function(){return e.goBackToRegister()}),l(41," Volver al Registro "),a()()()()()),n&2&&(s(9),c("ngIf",e.showSuccessAnimation),s(6),c("ngIf",e.formErrors==null?null:e.formErrors.general),s(),c("ngIf",e.successMessage&&!e.showSuccessAnimation),s(),c("ngClass",P(13,U,e.submitted&&!e.verificationCode||(e.formErrors==null?null:e.formErrors.code),e.verificationCode&&(e.submitted||!1))),s(4),E("ngModel",e.verificationCode),c("disabled",e.isVerifying),s(),c("ngIf",e.isVerifying),s(),c("ngIf",e.submitted&&!e.verificationCode||(e.formErrors==null?null:e.formErrors.code)),s(7),c("disabled",!e.verificationCode||e.isVerifying),s(),m(" ",e.isVerifying?"Verificando...":"Verificar Email"," "),s(5),c("disabled",!e.canResend||e.isVerifying),s(),c("ngIf",e.canResend),s(),c("ngIf",!e.canResend))},dependencies:[S,w,I,H,A,R,F,D,j,B,N,z,V],styles:["[_ngcontent-%COMP%]:root{--header-h: 0px;--primary-blue: #3b82f6;--primary-dark-blue: #1e40af;--success-color: #2ecc71;--error-color: #e74c3c;--text-primary: #ffffff;--text-secondary: #999;--bg-dark: #1c1f24;--bg-darker: #181a1f;--border-color: #3b414b;--teal: #14b8a6}app-navbar[_ngcontent-%COMP%]{display:none!important}.verify-email-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100vh;width:100%;overflow:hidden;background:#181818;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;padding:20px}.verify-form-section[_ngcontent-%COMP%]{background:#232323;display:flex;flex-direction:column;padding:40px 28px;border-radius:16px;box-shadow:0 20px 60px #00000080;width:100%;max-width:520px;position:relative}.verify-banner[_ngcontent-%COMP%]{display:none}.verify-title[_ngcontent-%COMP%]{color:#fff;font-size:32px;font-weight:800;margin:0 0 12px;text-align:center;animation:_ngcontent-%COMP%_slideDown .5s ease}.verify-subtitle[_ngcontent-%COMP%]{color:#999;font-size:14px;text-align:center;margin:0 0 28px;line-height:1.6;animation:_ngcontent-%COMP%_slideDown .5s ease .1s backwards}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.verify-form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:1.2rem;background:transparent;border:none;border-radius:0;padding:0;box-shadow:none}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem}.label[_ngcontent-%COMP%]{color:#ccc;font-size:.95rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.control[_ngcontent-%COMP%]{background:#181a1f;border:1px solid #3b414b;color:#fff;padding:.9rem 1rem;border-radius:10px;font-size:1rem;outline:0;transition:all .15s ease;font-family:Courier New,monospace;letter-spacing:1px}.control[_ngcontent-%COMP%]:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f62e}.control[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;background:#141618}.field.valid[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{border-color:#2ecc71;box-shadow:0 0 0 3px #2ecc711a}.field.invalid[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{border-color:#e74c3c;box-shadow:0 0 0 3px #e74c3c1a}.code-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.code-input-wrapper[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{flex:1}.verifying-spinner[_ngcontent-%COMP%]{position:absolute;right:12px;font-size:1.3rem;animation:_ngcontent-%COMP%_spin 1.5s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-msg[_ngcontent-%COMP%]{margin-top:.4rem;background:#e74c3c14;border-left:3px solid #e74c3c;padding:.6rem .8rem;border-radius:6px;color:#ffb4b4;font-size:.93rem;line-height:1.4}.general-error[_ngcontent-%COMP%]{margin:0;padding:1rem;border-radius:8px;text-align:center;font-weight:500;animation:_ngcontent-%COMP%_slideDown .3s ease;background:#e74c3c26;border:1px solid rgba(231,76,60,.3)}.success-msg[_ngcontent-%COMP%]{padding:.8rem 1rem;background:#2ecc711a;border:1px solid #2ecc71;border-radius:8px;color:#7ee787;font-size:.95rem;font-weight:500;text-align:center;animation:_ngcontent-%COMP%_slideDown .3s ease}.success-message[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;color:#2ecc71;padding:2rem 3rem;border-radius:12px;font-size:1.5rem;font-weight:800;text-align:center;box-shadow:0 20px 60px #0000004d;z-index:1000;animation:_ngcontent-%COMP%_popIn .5s ease}@keyframes _ngcontent-%COMP%_popIn{0%{opacity:0;transform:translate(-50%,-50%) scale(.7)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}.help-text[_ngcontent-%COMP%]{background:#3b82f60d;border:1px solid rgba(59,130,246,.2);border-radius:8px;padding:1rem;margin:.5rem 0}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;color:#aaa;font-size:.9rem;line-height:1.5}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{margin-top:0}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:.5rem}.verify-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;border-radius:10px;padding:.9rem 2rem;font-size:.98rem;font-weight:700;letter-spacing:.3px;cursor:pointer;transition:all .2s ease;width:100%;box-shadow:0 4px 12px #3b82f64d}.verify-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#2563eb,#1d4ed8);box-shadow:0 6px 20px #3b82f666;transform:translateY(-2px)}.verify-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.verify-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.divider[_ngcontent-%COMP%]{height:1px;background:#303641;margin:.5rem 0}.resend-section[_ngcontent-%COMP%]{text-align:center}.resend-label[_ngcontent-%COMP%]{color:#666;font-size:.9rem;margin-bottom:.8rem;margin-top:0}.resend-btn[_ngcontent-%COMP%]{background:transparent;color:#3b82f6;border:1px solid #3b82f6;border-radius:8px;padding:.7rem 1.5rem;font-size:.93rem;font-weight:600;cursor:pointer;transition:all .2s ease;width:100%}.resend-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#3b82f61a;border-color:#60a5fa;color:#60a5fa}.resend-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.back-section[_ngcontent-%COMP%]{text-align:center;padding-top:.5rem}.back-btn[_ngcontent-%COMP%]{background:transparent;color:#666;border:none;padding:.5rem 1rem;font-size:.9rem;cursor:pointer;transition:color .2s ease;text-decoration:underline}.back-btn[_ngcontent-%COMP%]:hover{color:#3b82f6}@media (max-width: 1024px){.verify-form-section[_ngcontent-%COMP%]{max-width:480px;padding:32px 24px}}@media (max-width: 480px){.verify-form-section[_ngcontent-%COMP%]{max-width:100%;padding:24px 16px;border-radius:12px}.verify-title[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px}.verify-subtitle[_ngcontent-%COMP%]{font-size:13px;margin-bottom:20px}.verify-btn[_ngcontent-%COMP%], .resend-btn[_ngcontent-%COMP%]{font-size:.9rem;padding:.7rem 1rem}.control[_ngcontent-%COMP%]{padding:.8rem .9rem;font-size:.95rem}}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0;padding:0;overflow:auto}"]})};export{L as VerifyEmailComponent};
