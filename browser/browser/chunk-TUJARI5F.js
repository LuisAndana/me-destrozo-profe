import{a as V}from"./chunk-BOOOHMUF.js";import{b as T,d as D,g as N,y as q}from"./chunk-T5YDL63U.js";import{e as F,j as z}from"./chunk-XCTHI3QZ.js";import{$b as I,K as b,La as y,Pa as g,U as x,Wa as d,Xa as i,Ya as r,Z as u,Za as h,_ as v,ac as S,db as _,eb as p,f as w,gb as c,gc as E,nb as M,pb as s,qb as f,rb as C,ta as O,tb as P,ub as k,vb as j,wa as a}from"./chunk-VJI5GMUY.js";import"./chunk-FDERIQAA.js";function L(t,n){if(t&1){let e=_();i(0,"button",16),p("click",function(){u(e);let l=c();return v(l.limpiarBusqueda())}),s(1," \u2715 "),r()}}function $(t,n){t&1&&(i(0,"div",17),h(1,"div",18),i(2,"p"),s(3,"Cargando conversaciones..."),r()())}function B(t,n){if(t&1){let e=_();i(0,"div",19)(1,"span",20),s(2,"\u26A0\uFE0F"),r(),i(3,"p"),s(4),r(),i(5,"button",21),p("click",function(){u(e);let l=c();return v(l.recargar())}),s(6,"Reintentar"),r()()}if(t&2){let e=c();a(4),f(e.error)}}function R(t,n){if(t&1){let e=_();i(0,"button",21),p("click",function(){u(e);let l=c(2);return v(l.nuevaConversacion())}),s(1," Nueva Conversaci\xF3n "),r()}}function W(t,n){if(t&1&&(i(0,"div",22)(1,"div",23),s(2,"\u{1F4AC}"),r(),i(3,"h2"),s(4),r(),i(5,"p"),s(6),r(),g(7,R,2,0,"button",24),r()),t&2){let e=c();a(4),f(e.busqueda?"Sin resultados":"No tienes conversaciones"),a(2),f(e.busqueda?"Intenta con otra b\xFAsqueda":"Comienza una nueva conversaci\xF3n para empezar a chatear"),a(),d("ngIf",!e.busqueda)}}function U(t,n){if(t&1){let e=_();i(0,"img",40),p("error",function(l){u(e);let m=c(3);return v(m.onImageError(l))}),r()}if(t&2){let e=c().$implicit,o=c(2);d("src",e.otro_usuario.foto_url,O)("alt",o.obtenerNombreCompleto(e.otro_usuario))}}function Y(t,n){if(t&1&&(i(0,"div",41),s(1),r()),t&2){let e=c().$implicit,o=c(2);a(),C(" ",o.obtenerIniciales(e.otro_usuario)," ")}}function G(t,n){if(t&1&&(i(0,"div",42),s(1),r()),t&2){let e=c().$implicit;a(),C(" ",e.mensajes_no_leidos>99?"99+":e.mensajes_no_leidos," ")}}function H(t,n){if(t&1&&(i(0,"span",43),s(1),r()),t&2){let e=c().$implicit;a(),C(" ",e.ultimo_mensaje.leido?"\u2713\u2713":"\u2713"," ")}}function J(t,n){t&1&&h(0,"div",44)}function K(t,n){if(t&1){let e=_();i(0,"div",27),p("click",function(){let l=u(e).$implicit,m=c(2);return v(m.abrirConversacion(l))}),i(1,"div",28),g(2,U,1,2,"img",29)(3,Y,2,1,"div",30)(4,G,2,1,"div",31),r(),i(5,"div",32)(6,"div",33)(7,"h3",34),s(8),r(),i(9,"span",35),s(10),r()(),i(11,"div",36),g(12,H,2,1,"span",37),i(13,"span",38),s(14),r()()(),g(15,J,1,0,"div",39),r()}if(t&2){let e=n.$implicit,o=c(2);M("no-leida",e.mensajes_no_leidos>0),a(2),d("ngIf",e.otro_usuario.foto_url),a(),d("ngIf",!e.otro_usuario.foto_url),a(),d("ngIf",e.mensajes_no_leidos>0),a(4),f(o.obtenerNombreCompleto(e.otro_usuario)),a(2),f(o.formatearFecha(e.ultimo_mensaje.fecha_envio)),a(2),d("ngIf",e.ultimo_mensaje.es_remitente),a(),M("no-leido",!e.ultimo_mensaje.leido&&!e.ultimo_mensaje.es_remitente),a(),C(" ",o.truncarContenido(e.ultimo_mensaje.contenido)," "),a(),d("ngIf",e.mensajes_no_leidos>0)}}function Q(t,n){if(t&1&&(i(0,"div",25),g(1,K,16,12,"div",26),r()),t&2){let e=c();a(),d("ngForOf",e.conversacionesFiltradas)}}var A=class t{mensajesService=x(V);router=x(F);destroy$=new w;conversaciones=[];conversacionesFiltradas=[];cargando=!0;error=null;busqueda="";mensajesNoLeidos=0;defaultAvatar='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Crect fill="%236366f1" width="100" height="100"/%3E%3Ctext x="50" y="50" font-size="40" fill="white" text-anchor="middle" dy=".3em"%3E?%3C/text%3E%3C/svg%3E';ngOnInit(){console.log("\u{1F4AC} [INIT] ConversacionesComponent inicializado"),this.cargarConversaciones(),this.suscribirseAMensajesNoLeidos()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarConversaciones(){console.log("\u{1F4AC} [CARGA] Obteniendo conversaciones..."),this.cargando=!0,this.error=null,this.mensajesService.obtenerConversaciones().pipe(b(this.destroy$)).subscribe({next:n=>{console.log("\u2705 Conversaciones cargadas:",n.length),this.conversaciones=n,this.conversacionesFiltradas=n,this.cargando=!1},error:n=>{console.error("\u274C Error al cargar conversaciones:",n),this.error="No se pudieron cargar las conversaciones",this.cargando=!1}})}suscribirseAMensajesNoLeidos(){this.mensajesService.mensajesNoLeidos$.pipe(b(this.destroy$)).subscribe({next:n=>{this.mensajesNoLeidos=n}})}filtrarConversaciones(){let n=this.busqueda.toLowerCase().trim();if(!n){this.conversacionesFiltradas=this.conversaciones;return}this.conversacionesFiltradas=this.conversaciones.filter(e=>{let o=this.mensajesService.obtenerNombreCompleto(e.otro_usuario).toLowerCase(),l=(e.otro_usuario.email||"").toLowerCase(),m=(e.ultimo_mensaje.contenido||"").toLowerCase();return o.includes(n)||l.includes(n)||m.includes(n)})}limpiarBusqueda(){this.busqueda="",this.filtrarConversaciones()}abrirConversacion(n){console.log("\u{1F4AC} Abriendo conversaci\xF3n con:",n.otro_usuario.nombre),this.router.navigate(["/mensajes/chat",n.otro_usuario.id_usuario])}nuevaConversacion(){this.router.navigate(["/mensajes/nueva"])}recargar(){this.cargarConversaciones(),this.mensajesService.actualizarContadorMensajes()}obtenerIniciales(n){return this.mensajesService.obtenerIniciales(n)}obtenerNombreCompleto(n){return this.mensajesService.obtenerNombreCompleto(n)}formatearFecha(n){return this.mensajesService.formatearFechaMensaje(n)}truncarContenido(n,e=50){return n?n.length>e?n.substring(0,e)+"...":n:""}onImageError(n){n.target.src=this.defaultAvatar}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-conversaciones"]],decls:22,vars:6,consts:[[1,"conversaciones-container"],[1,"conversaciones-header"],[1,"header-actions"],["title","Recargar",1,"btn-icon",3,"click"],[1,"icon"],["title","Nueva conversaci\xF3n",1,"btn-icon",3,"click"],[1,"search-bar"],[1,"search-input-wrapper"],[1,"search-icon"],["type","text","placeholder","Buscar conversaciones...",1,"search-input",3,"ngModelChange","ngModel"],["class","clear-btn","title","Limpiar b\xFAsqueda",3,"click",4,"ngIf"],[1,"conversaciones-content"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","empty-container",4,"ngIf"],["class","conversaciones-lista",4,"ngIf"],["title","Limpiar b\xFAsqueda",1,"clear-btn",3,"click"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-container"],[1,"error-icon"],[1,"btn-primary",3,"click"],[1,"empty-container"],[1,"empty-icon"],["class","btn-primary",3,"click",4,"ngIf"],[1,"conversaciones-lista"],["class","conversacion-item",3,"no-leida","click",4,"ngFor","ngForOf"],[1,"conversacion-item",3,"click"],[1,"avatar-container"],["class","avatar",3,"src","alt","error",4,"ngIf"],["class","avatar avatar-placeholder",4,"ngIf"],["class","badge-no-leidos",4,"ngIf"],[1,"conversacion-info"],[1,"conversacion-header-info"],[1,"nombre"],[1,"fecha"],[1,"ultimo-mensaje"],["class","mensaje-indicador",4,"ngIf"],[1,"mensaje-contenido"],["class","indicador-no-leido",4,"ngIf"],[1,"avatar",3,"error","src","alt"],[1,"avatar","avatar-placeholder"],[1,"badge-no-leidos"],[1,"mensaje-indicador"],[1,"indicador-no-leido"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),s(3,"\u{1F4AC} Mensajes"),r(),i(4,"div",2)(5,"button",3),p("click",function(){return o.recargar()}),i(6,"span",4),s(7,"\u{1F504}"),r()(),i(8,"button",5),p("click",function(){return o.nuevaConversacion()}),i(9,"span",4),s(10,"\u270F\uFE0F"),r()()()(),i(11,"div",6)(12,"div",7)(13,"span",8),s(14,"\u{1F50D}"),r(),i(15,"input",9),j("ngModelChange",function(m){return k(o.busqueda,m)||(o.busqueda=m),m}),p("ngModelChange",function(){return o.filtrarConversaciones()}),r(),g(16,L,2,0,"button",10),r()(),i(17,"div",11),g(18,$,4,0,"div",12)(19,B,7,1,"div",13)(20,W,8,3,"div",14)(21,Q,2,1,"div",15),r()()),e&2&&(a(15),P("ngModel",o.busqueda),a(),d("ngIf",o.busqueda),a(2),d("ngIf",o.cargando),a(),d("ngIf",o.error&&!o.cargando),a(),d("ngIf",!o.cargando&&!o.error&&o.conversacionesFiltradas.length===0),a(),d("ngIf",!o.cargando&&!o.error&&o.conversacionesFiltradas.length>0))},dependencies:[E,I,S,z,q,T,D,N],styles:[".conversaciones-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;max-height:100vh;background:linear-gradient(135deg,#0f1419,#1a202c);overflow:hidden}.conversaciones-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;background:#1e2836cc;border-bottom:1px solid rgba(42,63,95,.3);box-shadow:0 2px 8px #0000004d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.conversaciones-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:700;color:#fff;letter-spacing:-.5px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;border:none;background:#ffffff0d;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;font-size:1.2rem}.btn-icon[_ngcontent-%COMP%]:hover{background:#00a88433}.btn-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:1.2rem}.search-bar[_ngcontent-%COMP%]{padding:1rem 1.5rem;background:#1e283666;border-bottom:1px solid rgba(42,63,95,.3)}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background:#141e2dcc;border-radius:10px;padding:.75rem 1rem;border:1px solid rgba(42,63,95,.3);transition:all .3s ease}.search-input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:#00a88480;box-shadow:0 0 12px #00a88433}.search-icon[_ngcontent-%COMP%]{font-size:1.2rem;margin-right:.75rem;color:#8696a0}.search-input[_ngcontent-%COMP%]{flex:1;border:none;background:transparent;outline:none;font-size:.95rem;color:#fff;font-family:inherit}.search-input[_ngcontent-%COMP%]::placeholder{color:#8696a0}.clear-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#8696a0;font-size:1.2rem;padding:0;margin-left:.5rem;transition:all .2s ease}.clear-btn[_ngcontent-%COMP%]:hover{color:#00a884;transform:scale(1.1)}.conversaciones-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:transparent}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 2rem;text-align:center}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(0,168,132,.2);border-top-color:#00a884;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin-bottom:.5rem}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8696a0;margin-bottom:1.5rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#00a884,#008c6f);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:10px;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px #00a8844d}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #00a88466}.conversaciones-lista[_ngcontent-%COMP%]{display:flex;flex-direction:column}.conversacion-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 1.5rem;cursor:pointer;border-bottom:1px solid rgba(42,63,95,.2);transition:all .3s ease;position:relative}.conversacion-item[_ngcontent-%COMP%]:hover{background:#00a8840d;padding-left:1.75rem}.conversacion-item.no-leida[_ngcontent-%COMP%]{background:#00a88414}.avatar-container[_ngcontent-%COMP%]{position:relative;margin-right:1rem;flex-shrink:0}.avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid rgba(0,168,132,.3)}.avatar-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:600;font-size:1.1rem;border:2px solid rgba(0,168,132,.3)}.badge-no-leidos[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#00a884,#008c6f);color:#fff;font-size:.65rem;font-weight:700;padding:.25rem .5rem;border-radius:10px;min-width:22px;text-align:center;box-shadow:0 2px 8px #00a88466}.conversacion-info[_ngcontent-%COMP%]{flex:1;min-width:0}.conversacion-header-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.nombre[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.fecha[_ngcontent-%COMP%]{font-size:.8rem;color:#8696a0;flex-shrink:0;margin-left:.75rem}.ultimo-mensaje[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:#8696a0}.mensaje-indicador[_ngcontent-%COMP%]{color:#00a884;font-weight:700;font-size:.8rem}.mensaje-contenido[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mensaje-contenido.no-leido[_ngcontent-%COMP%]{font-weight:600;color:#fff}.indicador-no-leido[_ngcontent-%COMP%]{width:10px;height:10px;background:linear-gradient(135deg,#00a884,#008c6f);border-radius:50%;position:absolute;right:1.5rem;top:50%;transform:translateY(-50%);box-shadow:0 0 8px #00a88480}@media (max-width: 768px){.conversaciones-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.conversacion-item[_ngcontent-%COMP%]{padding:.75rem 1rem}.avatar[_ngcontent-%COMP%]{width:45px;height:45px}.nombre[_ngcontent-%COMP%]{font-size:.95rem}.ultimo-mensaje[_ngcontent-%COMP%]{font-size:.8rem}}.conversaciones-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.conversaciones-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.conversaciones-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#00a8844d;border-radius:3px}.conversaciones-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#00a88480}"]})};export{A as ConversacionesComponent};
